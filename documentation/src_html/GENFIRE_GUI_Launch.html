<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>../GENFIRE_GUI_Launch</title>
  <meta name="description" content="GENFIRE Documentation">
  <meta name="author" content="Alan (AJ) Pryor, Jr.">  <link rel="stylesheet" href="css/styles.css?v=1.0">
  <link rel="stylesheet" type="text/css" href="main.css">
</head>
<body>
<code><font color="green">from</font> PyQt4 <font color="green">import</font> QtCore, QtGui<br><font color="green">import</font> GENFIRE_GUI<br><font color="green">import</font> GENFIRE<br><font color="green">import</font> ProjectionCalculator<br><font color="green">import</font> GENFIRE_main<br><font color="green">import</font> os<br><font color="green">import</font> sys<br><font color="green">from</font> GENFIRE <font color="green">import</font> ReconstructionParameters<br><font color="green">import</font> matplotlib<br>matplotlib.use("Qt4Agg")<br><br><font color="green">class</font> GenfireMainWindow(QtGui.QMainWindow): #Sub<font color="green">class</font>es QMainWindow<br>    <font color="green">def</font> __init__(<font color="green">self</font>):<br><br>        ## Super<font color="green">class</font> constructor<br>        super(GenfireMainWindow,<font color="green">self</font>).__init__()<br><br>        ## Initialize UI<br>        <font color="green">self</font>.ui = GENFIRE_GUI.Ui_MainWindow()<br>        <font color="green">self</font>.ui.setupUi(<font color="green">self</font>)<br>        <font color="green">self</font>.setWindowIcon(QtGui.QIcon('test.png'))<br><br>        ## Initialize Reconstruction Parameters<br>        <font color="green">self</font>.GENFIRE_ReconstructionParameters = ReconstructionParameters()<br><br>        ## Initialize file paths in text boxes<br>        <font color="green">self</font>.ui.lineEdit_results.setText(QtCore.QString(os.path.join(os.getcwd(),'results.mrc')))<br><br>        <font color="green">self</font>.ui.lineEdit_support.setText(QtCore.QString(os.getcwd()))<br><br>        <font color="green">self</font>.ui.lineEdit_pj.setText(QtCore.QString(os.getcwd()))<br><br>        <font color="green">self</font>.ui.lineEdit_io.setText(QtCore.QString(os.getcwd()))<br><br>        <font color="green">self</font>.ui.lineEdit_angle.setText(QtCore.QString(os.getcwd()))<br><br><br>        ## Push Buttons -- connect each to their main function and check <font color="green">if</font> the reconstruction parameters are good each<br>        ## time a parameter is changed<br>        <font color="green">self</font>.ui.btn_projections.clicked.connect(<font color="green">self</font>.selectProjectionFile)<br>        <font color="green">self</font>.ui.btn_projections.clicked.connect(<font color="green">self</font>.checkParameters)<br><br>        <font color="green">self</font>.ui.btn_angles.clicked.connect(<font color="green">self</font>.selectAngleFile)<br>        <font color="green">self</font>.ui.btn_angles.clicked.connect(<font color="green">self</font>.checkParameters)<br><br>        <font color="green">self</font>.ui.btn_support.clicked.connect(<font color="green">self</font>.selectSupportFile)<br>        <font color="green">self</font>.ui.btn_support.clicked.connect(<font color="green">self</font>.checkParameters)<br><br>        <font color="green">self</font>.ui.btn_io.clicked.connect(<font color="green">self</font>.selectInitialObjectFile)<br>        <font color="green">self</font>.ui.btn_io.clicked.connect(<font color="green">self</font>.checkParameters)<br><br>        <font color="green">self</font>.ui.btn_reconstruct.clicked.connect(<font color="green">self</font>.startReconstruction)<br>        <font color="green">self</font>.ui.btn_reconstruct.clicked.connect(<font color="green">self</font>.checkParameters)<br>        <font color="green">self</font>.ui.btn_reconstruct.setStyleSheet("background-color: red")<br><br>        ## Line Edits -- connect each to their main function and check <font color="green">if</font> the reconstruction parameters are good each<br>        ## time a parameter is changed<br>        <font color="green">self</font>.ui.lineEdit_pj.textChanged.connect(<font color="green">self</font>.GENFIRE_ReconstructionParameters.setProjectionFilename)<br>        <font color="green">self</font>.ui.lineEdit_pj.textChanged.connect(<font color="green">self</font>.checkParameters)<br><br>        <font color="green">self</font>.ui.lineEdit_angle.textChanged.connect(<font color="green">self</font>.GENFIRE_ReconstructionParameters.setAngleFilename)<br>        <font color="green">self</font>.ui.lineEdit_angle.textChanged.connect(<font color="green">self</font>.checkParameters)<br><br>        <font color="green">self</font>.ui.lineEdit_support.textChanged.connect(<font color="green">self</font>.GENFIRE_ReconstructionParameters.setSupportFilename)<br>        <font color="green">self</font>.ui.lineEdit_support.textChanged.connect(<font color="green">self</font>.checkParameters)<br><br>        <font color="green">self</font>.ui.lineEdit_io.textChanged.connect(<font color="green">self</font>.GENFIRE_ReconstructionParameters.setInitialObjectFilename)<br>        <font color="green">self</font>.ui.lineEdit_io.textChanged.connect(<font color="green">self</font>.checkParameters)<br><br>        <font color="green">self</font>.ui.lineEdit_results.textChanged.connect(<font color="green">self</font>.GENFIRE_ReconstructionParameters.setResultsFilename)<br>        <font color="green">self</font>.ui.lineEdit_results.textChanged.connect(<font color="green">self</font>.checkParameters)<br><br>        <font color="green">self</font>.ui.lineEdit_numIterations.setText(QtCore.QString("50"))<br>        <font color="green">self</font>.ui.lineEdit_numIterations.textChanged.connect(<font color="green">self</font>.GENFIRE_ReconstructionParameters.setNumberOfIterations)<br>        <font color="green">self</font>.ui.lineEdit_numIterations.textChanged.connect(<font color="green">self</font>.checkParameters)<br><br>        <font color="green">self</font>.ui.lineEdit_oversamplingRatio.setText(QtCore.QString("3"))<br>        <font color="green">self</font>.ui.lineEdit_oversamplingRatio.textChanged.connect(<font color="green">self</font>.GENFIRE_ReconstructionParameters.setOversamplingRatio)<br>        <font color="green">self</font>.ui.lineEdit_oversamplingRatio.textChanged.connect(<font color="green">self</font>.checkParameters)<br><br>        <font color="green">self</font>.ui.lineEdit_interpolationCutoffDistance.setText(QtCore.QString("0.7"))<br>        <font color="green">self</font>.ui.lineEdit_interpolationCutoffDistance.textChanged.connect(<font color="green">self</font>.GENFIRE_ReconstructionParameters.setInterpolationCutoffDistance)<br>        <font color="green">self</font>.ui.lineEdit_interpolationCutoffDistance.textChanged.connect(<font color="green">self</font>.checkParameters)<br><br><br>        <font color="green">self</font>.ui.lineEdit_displayFrequency.setDisabled(True)<br>        <font color="green">self</font>.ui.lineEdit_displayFrequency.setStyleSheet("background-color: gray")<br>        <font color="green">self</font>.ui.lineEdit_displayFrequency.textChanged.connect(<font color="green">self</font>.ShoutDisplayFrequency)<br><br>        <font color="green">self</font>.ui.lineEdit_io.setDisabled(True)<br>        <font color="green">self</font>.ui.lineEdit_io.setStyleSheet("background-color: gray")<br><br><br>        ## Radio Buttons -- <font color="green">def</font>ault is resolution extension suppression<br>        <font color="green">self</font>.ui.radioButton_on.setChecked(True)<br>        <font color="green">self</font>.ui.radioButton_on.toggled.connect(<font color="green">self</font>.selectResolutionExtensionSuppressionState)<br><br>        <font color="green">self</font>.ui.radioButton_off.toggled.connect(<font color="green">self</font>.selectResolutionExtensionSuppressionState)<br><br>        <font color="green">self</font>.ui.radioButton_extension.toggled.connect(<font color="green">self</font>.selectResolutionExtensionSuppressionState)<br><br><br>        ## Check Boxes<br><br>        <font color="green">self</font>.ui.checkBox_displayFigure.toggled.connect(<font color="green">self</font>.GENFIRE_ReconstructionParameters.toggleDisplayFigure)<br>        <font color="green">self</font>.ui.checkBox_displayFigure.toggled.connect(<font color="green">self</font>.enableDisplayFrequencyChange)<br><br>        <font color="green">self</font>.ui.checkBox_log.toggled.connect(<font color="green">self</font>.enableLog)<br><br>        <font color="green">self</font>.ui.checkBox_rfree.toggled.connect(<font color="green">self</font>.calculateRfree)<br><br>        <font color="green">self</font>.ui.checkBox_provide_io.toggled.connect(<font color="green">self</font>.toggleSelectIO)<br><br>        <font color="green">self</font>.ui.checkBox_<font color="green">def</font>ault_support.toggled.connect(<font color="green">self</font>.toggleUseDefaultSupport)<br><br>        <font color="green">self</font>.ui.action_Create_Support.triggered.connect(<font color="green">self</font>.launchProjectionCalculator)<br><br>    <font color="green">def</font> calculateRfree(<font color="green">self</font>):<br>        <font color="green">if</font> <font color="green">self</font>.ui.checkBox_rfree.isEnabled() == True:<br>            <font color="green">self</font>.GENFIRE_ReconstructionParameters.calculateRfree = True<br>        else:<br>            <font color="green">self</font>.GENFIRE_ReconstructionParameters.calculateRfree = False<br><br>    <font color="green">def</font> launchProjectionCalculator(<font color="green">self</font>):<br>        print "launching"<br>        <font color="green">self</font>.GENFIRE_ProjectionCalculator = ProjectionCalculator.ProjectionCalculator()<br>        <font color="green">self</font>.GENFIRE_ProjectionCalculator.show()<br><br>    <font color="green">def</font> enableLog(<font color="green">self</font>):<br>        sys.stdout = GenfireLogger(<font color="green">self</font>.ui.log, sys.stdout )<br>        sys.stderr = GenfireLogger(<font color="green">self</font>.ui.log, sys.stderr, QtGui.QColor(255,0,0))<br><br>    <font color="green">def</font> toggleSelectIO(<font color="green">self</font>):<br>        <font color="green">if</font> <font color="green">self</font>.ui.lineEdit_io.isEnabled():<br>             <font color="green">self</font>.ui.lineEdit_io.setStyleSheet("background-color: gray")<br>             <font color="green">self</font>.ui.lineEdit_io.setEnabled(False)<br>             <font color="green">self</font>.GENFIRE_ReconstructionParameters._initialObjectFilename=""<br>        else:<br>             <font color="green">self</font>.ui.lineEdit_io.setStyleSheet("background-color: white")<br>             <font color="green">self</font>.ui.lineEdit_io.setEnabled(True)<br><br>    <font color="green">def</font> toggleUseDefaultSupport(<font color="green">self</font>):<br>        <font color="green">if</font> <font color="green">self</font>.ui.checkBox_<font color="green">def</font>ault_support.isEnabled():<br>            <font color="green">self</font>.GENFIRE_ReconstructionParameters.useDefaultSupport = True<br>        else:<br>            <font color="green">self</font>.GENFIRE_ReconstructionParameters.useDefaultSupport = False<br><br>    <font color="green">def</font> enableDisplayFrequencyChange(<font color="green">self</font>):<br>        global displayFrequency<br>        displayFrequency = 5<br>        <font color="green">self</font>.ui.lineEdit_displayFrequency.setEnabled(True)<br>        <font color="green">self</font>.ui.lineEdit_displayFrequency.setText(QtCore.QString("5"))<br>        <font color="green">self</font>.ui.lineEdit_displayFrequency.setStyleSheet("background-color: white")<br><br>    <font color="green">def</font> ShoutDisplayFrequency(<font color="green">self</font>, frequency):<br>        <font color="green">self</font>.GENFIRE_ReconstructionParameters.displayFigure.displayFrequency = frequency.toInt()[0]<br>        print type(<font color="green">self</font>.GENFIRE_ReconstructionParameters.displayFigure.displayFrequency)<br>        print "updating displayFrequency", <font color="green">self</font>.GENFIRE_ReconstructionParameters.displayFigure.displayFrequency<br><br>    <font color="green">def</font> messageWritten(<font color="green">self</font>, message):<br>        print message<br>    <font color="green">def</font> __del__(<font color="green">self</font>):<br>        sys.stdout = sys.__stdout__ # Restore output stream to <font color="green">def</font>ault upon exiting the GUI<br>    #Functions <font color="green">for</font> selecting input files using QFileDialog<br>    <font color="green">def</font> selectProjectionFile(<font color="green">self</font>):<br>        filename = QtGui.QFileDialog.getOpenFileName(QtGui.QFileDialog(), "Select File Containing Projections",filter="MATLAB files (*.mat);;TIFF images (*.t<font color="green">if</font> *.t<font color="green">if</font>f);;MRC (*.mrc);;All Files (*)")<br><br>        <font color="green">if</font> filename:<br>            <font color="green">self</font>.GENFIRE_ReconstructionParameters.setProjectionFilename(filename)<br>            print ("Projection Filename:", <font color="green">self</font>.GENFIRE_ReconstructionParameters.getProjectionFilename())<br>            <font color="green">self</font>.ui.lineEdit_pj.setText(QtCore.QString(filename))<br><br>    <font color="green">def</font> selectAngleFile(<font color="green">self</font>):<br>        filename = QtGui.QFileDialog.getOpenFileName(QtGui.QFileDialog(), "Select File Containing Support",filter="MATLAB files (*.mat);;text files (*.txt *.t<font color="green">if</font>f);;MRC (*.mrc);;All Files (*)")<br>        <font color="green">if</font> filename:<br>            <font color="green">self</font>.GENFIRE_ReconstructionParameters.setAngleFilename(filename)<br>            print ("Angle Filename:", <font color="green">self</font>.GENFIRE_ReconstructionParameters.getAngleFilename())<br>            <font color="green">self</font>.ui.lineEdit_angle.setText(QtCore.QString(filename))<br><br>    <font color="green">def</font> selectSupportFile(<font color="green">self</font>):<br>        filename = QtGui.QFileDialog.getOpenFileName(QtGui.QFileDialog(), "Select File Containing Support",filter="MATLAB files (*.mat);;TIFF images (*.t<font color="green">if</font> *.t<font color="green">if</font>f);;MRC (*.mrc);;All Files (*)")<br>        <font color="green">if</font> filename:<br>            <font color="green">self</font>.GENFIRE_ReconstructionParameters.setSupportFilename(filename)<br>            print ("Support Filename:", <font color="green">self</font>.GENFIRE_ReconstructionParameters.getSupportFilename())<br>            <font color="green">self</font>.ui.lineEdit_support.setText(QtCore.QString(filename))<br><br>    <font color="green">def</font> selectInitialObjectFile(<font color="green">self</font>):<br>        filename = QtGui.QFileDialog.getOpenFileName(QtGui.QFileDialog(), "Select File Containing Initial Object",filter="MATLAB files (*.mat);;TIFF images (*.t<font color="green">if</font> *.t<font color="green">if</font>f);;MRC (*.mrc);;All Files (*)")<br>        <font color="green">if</font> filename:<br>            <font color="green">self</font>.GENFIRE_ReconstructionParameters.setInitialObjectFilename(filename)<br>            print ("Initial Object Filename:", <font color="green">self</font>.GENFIRE_ReconstructionParameters.getProjectionFilename())<br>            <font color="green">self</font>.ui.lineEdit_io.setText(QtCore.QString(filename))<br><br>    #Define constraint en<font color="green">for</font>cement mode<br>    <font color="green">def</font> selectResolutionExtensionSuppressionState(<font color="green">self</font>):<br>        <font color="green">if</font> <font color="green">self</font>.ui.radioButton_on.isChecked():<br>            <font color="green">self</font>.GENFIRE_ReconstructionParameters.setResolutionExtensionSuppressionState(1)<br>        el<font color="green">if</font> <font color="green">self</font>.ui.radioButton_extension.isChecked():<br>            <font color="green">self</font>.GENFIRE_ReconstructionParameters.setResolutionExtensionSuppressionState(3)<br>        else:<br>            <font color="green">self</font>.GENFIRE_ReconstructionParameters.setResolutionExtensionSuppressionState(2)<br><br>    <font color="green">def</font> checkParameters(<font color="green">self</font>):<br>        parametersAreGood = <font color="green">self</font>.GENFIRE_ReconstructionParameters.checkParameters()<br>        <font color="green">if</font> parametersAreGood: #update "go" button <font color="green">if</font> we are ready<br>            GF_window.ui.btn_reconstruct.setStyleSheet("background-color: GREEN")<br>            GF_window.ui.btn_reconstruct.setText("Launch Reconstruction!")<br>    #Function to run GENFIRE reconstruction once all parameters are accounted <font color="green">for</font><br>    <font color="green">def</font> startReconstruction(<font color="green">self</font>):<br>        print('GENFIRE: Launching GENFIRE Reconstruction')<br>        GENFIRE_main.GENFIRE_main(<font color="green">self</font>.GENFIRE_ReconstructionParameters)<br><br><font color="green">class</font> GenfireLogger:<br>    <font color="green">def</font> __init__(<font color="green">self</font>, textEdit, output=None, textColor=None):<br>        <font color="green">self</font>.textEdit = textEdit<br>        <font color="green">self</font>.output = None<br>        <font color="green">self</font>.textColor = textColor<br><br>    <font color="green">def</font> write(<font color="green">self</font>, message):<br>        <font color="green">if</font> <font color="green">self</font>.textColor:<br>            whichColor = <font color="green">self</font>.textEdit.texttextColor()<br>            <font color="green">self</font>.textEdit.setTexttextColor(<font color="green">self</font>.textColor)<br>        <font color="green">self</font>.textEdit.moveCursor(QtGui.QTextCursor.End)<br>        <font color="green">self</font>.textEdit.insertPlainText(message)<br>        <font color="green">if</font> <font color="green">self</font>.textColor:<br>            <font color="green">self</font>.textEdit.setTexttextColor(whichColor)<br>        <font color="green">if</font> <font color="green">self</font>.output:<br>            <font color="green">self</font>.output.write(message)<br><br><br><br><br><font color="green">if</font> __name__ == "<font color="green">__main__</font>":<br><br>    # Startup the application<br>    app = QtGui.QApplication(sys.argv)<br><br>    # app.setStyle('plastique')<br>    app.setStyle('mac')<br>    # app.setStyle('windows')<br>    # app.setStyle('cleanlooks')<br>    # app.setStyle('mot<font color="green">if</font>')<br>    # app.setStyle('GTK')<br><br><br>    # Create the GUI<br>    GF_window = GenfireMainWindow()<br><br>    # Render GUI<br>    GF_window.show()<br><br>    # Safely close and exit<br>    sys.exit(app.exec_())<br><br></code></body>
    </html>